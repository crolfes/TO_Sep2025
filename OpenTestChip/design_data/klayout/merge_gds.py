import klayout.db as db
import math

ly = db.Layout()
top_cell = ly.create_cell("TOP")

spacing =  80.0 #um
x = 0.0

for file in [ "S000_03.gds", "S022D_01.gds", "S038N.gds", "S046I_01.gds", "S075O.gds", "S179N.gds", "S194D_01.gds", "S300_02.gds", "S301D_02.gds", "S302_03.gds", "S303_01.gds", "S304N_Cu_02.gds", "S305D_03.gds", "S311B_02.gds", "S342K.gds", "S346K.gds", "S350B_01.gds", "S350B_01_DE.gds", "S351B_02.gds", "S351B_02_DE.gds", "S360D.gds", "S361D_06.gds", "S380_02.gds", "S381_02.gds", "S382_01.gds", "S383M.gds", "S384M.gds", "S385M.gds", "S387.gds", "S388.gds", "S393G.gds", "S393H_01.gds", "S403B.gds", "S427K_01.gds", "S434W_G2S_FINAL.gds", "S990_isol.gds", "S990_isol_large.gds"]:

  ly_import = db.Layout()
  ly_import.read(file)
  imported_top_cell = ly_import.top_cell()

  target_cell = ly.create_cell(imported_top_cell.name)
  target_cell.copy_tree(imported_top_cell)

  # frees the resources of the imported layout
  ly_import._destroy()

  inst = db.DCellInstArray(target_cell.cell_index(), db.DTrans(db.DVector(x, 0)))
  top_cell.insert(inst)

  x += target_cell.dbbox().width() + spacing

ly.write("layout_merge.gds")
